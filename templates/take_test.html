{% extends "base.html" %}
{% block title %} Index {% endblock %}
{%  block content %}
<h1 class="row col-md-12">
   Good luck {{ request.user.first_name }}!    
</h1>
<h4 class="row col-md-12">
   <small>You are taking
   <b>{{exam.name}}</b>
   worth {{exam.points}} Points </small>
</h4>
<hr/>
<div class="card">
   <div class="card-block">
      <form id="examform" >
         {% csrf_token %}
         {% if questions %}
         {% for key, value in questions.items %}
         <div class="card" style="background-color:#F2F2F2;color:black">
            <div class="card-block">
               <h2>{{key}} <small>({{value.question.points}})</small></h2>
               <hr/>
               <div class="row col-md-12">
                  {% for answerNumber in value.answerGroup.items %}
                  {% for answer in answerNumber%}
                  {%if answer.answer %}
                  <div class="input-group col-md-6">
                     <span class="input-group-addon">
                     {{answerNumber.0}}
                     </span>
                     <span class="input-group-addon">
                     <input type="radio" name="{{key}}" value="{{answerNumber}}" required>
                     </span>
                     <input type="text" class="form-control answerText" disabled placeholder="{{answer.answer}}">
                  </div>
                  {% endif %}
                  {% endfor %}
                  {% endfor %}
               </div>
            </div>
         </div>
         <br/>
         {% endfor %}
         {% endif%}
         <button onclick="" class=" col-md-12 btn btn-secondary">
         Submit Answers
         </button>
      </form>
   </div>
</div>
<script type="text/javascript">
   $(function() {
      $("#examform").submit(function(event){
          event.preventDefault();
          $("#examform").validate();
      $.confirm({
          title: "Submit exam?",
          content: "Do you want to submit your answers?",
          buttons: {
              yes: {
                  btnClass: "btn btn-primary",
                  text: "Yes, submit",
                  action: function() {
            $.ajaxSetup({
      beforeSend: function(xhr, settings) {
              xhr.setRequestHeader("X-CSRFToken", Cookies.get('csrftoken'));
          }
   });  
                      $.ajax({
         type: "POST",
         contentType: "application/x-www-form-urlencoded",
         url: "/delete_test/{{exam.name}}/",
         data: $("#examform").serialize(),
         success: function(data) {
             console.log(data);
             		$.confirm({
                      title: "Exam Submitted",
                      content: "Your score: <b>" + data.points+ "</b>/" +data.total,
                      buttons: {
                          okay: {
                              text: "Return home",
                              action: function() {
                                  window.location="/";
                              }    
                          }
                      }
                  })
      		},
          error: function(error) {
          	console.log(error);
          }
      });
                  }
              },
              no: {
                  text: "No! I'm not done"
              }
          }
      })
              });
      });
</script>
{% endblock %}